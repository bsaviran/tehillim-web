<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×ª×”×™×œ×™×</title>
    <meta property="og:description" content="×§×¨×™××ª ×ª×”×™×œ×™× ×™×•××™×ª ×‘×××©×§ × ×•×— ×•× ×§×™. ×œ×–×›×•×™×•×ª, ×œ×¨×¤×•××” ×•×œ×”×¦×œ×—×”.">
    <meta name="theme-color" content="#0a1628">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+Hebrew:wght@300;400;700;900&family=Heebo:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --gold: #c9a84c;
            --gold-light: #e8c97a;
            --gold-dim: rgba(201,168,76,0.15);
            --deep: #05101f;
            --navy: #0a1628;
            --navy-mid: #112240;
            --navy-light: #1a3358;
            --text: #f0e8d6;
            --text-dim: #8aa0b8;
            --parchment: #fdf6e3;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Heebo', sans-serif;
            background-color: var(--deep);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background:
                radial-gradient(ellipse at 20% 30%, rgba(201,168,76,0.06) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 70%, rgba(26,51,88,0.8) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 0%, rgba(10,22,40,0.9) 0%, transparent 60%);
            pointer-events: none;
            z-index: 0;
        }

        body::after {
            content: '';
            position: fixed;
            inset: 0;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E");
            pointer-events: none;
            z-index: 0;
            opacity: 0.4;
        }

        /* === HEADER === */
        header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: rgba(5,16,31,0.85);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(201,168,76,0.2);
            padding: 0 2rem;
        }

        .header-inner {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 72px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 14px;
        }

        .logo-icon {
            width: 44px;
            height: 44px;
            background: linear-gradient(135deg, var(--gold), var(--gold-light));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Noto Serif Hebrew', serif;
            font-size: 1.5rem;
            font-weight: 900;
            color: var(--deep);
            box-shadow: 0 0 20px rgba(201,168,76,0.3);
            flex-shrink: 0;
        }

        .logo-text {
            font-family: 'Noto Serif Hebrew', serif;
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--text);
            line-height: 1.1;
            display: block;
        }

        .logo-subtitle {
            font-size: 0.6rem;
            color: var(--gold);
            font-family: 'Heebo', sans-serif;
            font-weight: 400;
            line-height: 1.2;
            display: block;
        }

        @media (min-width: 600px) { 
            .logo-text { font-size: 1.1rem; }
            .logo-subtitle { font-size: 0.7rem; }
        }

        .header-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .btn-whatsapp {
            width: 42px;
            height: 42px;
            background: rgba(37,211,102,0.15);
            border: 1px solid rgba(37,211,102,0.3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            color: #25d366;
        }
        .btn-whatsapp:hover {
            background: rgba(37,211,102,0.25);
            transform: scale(1.08);
        }

        .btn-random {
            background: linear-gradient(135deg, var(--gold), var(--gold-light));
            color: var(--deep);
            border: none;
            padding: 10px 20px;
            border-radius: 50px;
            font-family: 'Heebo', sans-serif;
            font-size: 0.85rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(201,168,76,0.25);
            white-space: nowrap;
        }
        .btn-random:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(201,168,76,0.4);
        }

        /* === MAIN === */
        main {
            position: relative;
            z-index: 1;
            max-width: 900px;
            margin: 0 auto;
            padding: 3rem 1.5rem 5rem;
        }

        /* === DAILY SECTION === */
        .daily-section {
            margin-bottom: 3rem;
        }

        .daily-label {
            font-size: 0.7rem;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            color: var(--gold);
            margin-bottom: 1.2rem;
            text-align: center;
            font-weight: 500;
        }

        .days-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
        }

        @media (max-width: 600px) {
            .days-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        .day-card {
            background: var(--navy-mid);
            border: 1px solid rgba(201,168,76,0.15);
            border-radius: 14px;
            padding: 12px 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.25s;
            position: relative;
            overflow: hidden;
        }

        .day-card::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, var(--gold-dim), transparent);
            opacity: 0;
            transition: opacity 0.25s;
        }

        .day-card:hover::before,
        .day-card.today::before {
            opacity: 1;
        }

        .day-card:hover,
        .day-card.today {
            border-color: var(--gold);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3), 0 0 15px rgba(201,168,76,0.1);
        }

        .day-card.today {
            border-color: var(--gold);
            box-shadow: 0 0 0 1px var(--gold), 0 8px 25px rgba(201,168,76,0.2);
        }

        .today-badge {
            position: absolute;
            top: 5px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--gold);
            color: var(--deep);
            font-size: 0.45rem;
            font-weight: 700;
            padding: 2px 6px;
            border-radius: 20px;
            white-space: nowrap;
            letter-spacing: 0.05em;
        }

        .day-name {
            font-family: 'Noto Serif Hebrew', serif;
            font-size: 0.95rem;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 4px;
            position: relative;
            z-index: 1;
        }

        .day-card.today .day-name {
            color: var(--gold-light);
        }

        .day-range {
            font-family: 'Noto Serif Hebrew', serif;
            font-size: 0.65rem;
            color: var(--text-dim);
            line-height: 1.4;
            position: relative;
            z-index: 1;
        }

        .day-card.today .day-range {
            color: var(--gold);
        }

        .day-card .day-count {
            font-size: 0.55rem;
            color: rgba(201,168,76,0.5);
            margin-top: 3px;
            position: relative;
            z-index: 1;
        }

        /* === SELECTOR SECTION === */
        .selector-section {
            text-align: center;
            margin-bottom: 3rem;
        }

        .selector-label {
            font-size: 0.7rem;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            color: var(--gold);
            margin-bottom: 1.2rem;
            font-weight: 500;
        }

        .selector-wrapper {
            position: relative;
            display: inline-block;
            width: 100%;
            max-width: 340px;
        }

        .selector-wrapper::after {
            content: 'â—‚';
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gold);
            pointer-events: none;
            font-size: 0.8rem;
        }

        #perekSelect {
            width: 100%;
            padding: 14px 20px 14px 40px;
            background: var(--navy-mid);
            border: 1px solid rgba(201,168,76,0.3);
            border-radius: 16px;
            color: var(--text);
            font-family: 'Noto Serif Hebrew', serif;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            appearance: none;
            -webkit-appearance: none;
            outline: none;
            transition: all 0.3s;
            text-align: center;
        }
        #perekSelect:focus, #perekSelect:hover {
            border-color: var(--gold);
            box-shadow: 0 0 0 3px var(--gold-dim), 0 8px 30px rgba(0,0,0,0.3);
        }
        #perekSelect option {
            background: var(--navy-mid);
            color: var(--text);
        }

        .quick-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            margin-top: 1.5rem;
            max-width: 560px;
            margin-left: auto;
            margin-right: auto;
        }

        .quick-btn {
            width: 42px;
            height: 42px;
            background: var(--navy-mid);
            border: 1px solid rgba(201,168,76,0.15);
            border-radius: 10px;
            color: var(--text-dim);
            font-family: 'Noto Serif Hebrew', serif;
            font-size: 0.78rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .quick-btn:hover {
            background: var(--gold-dim);
            border-color: var(--gold);
            color: var(--gold);
            transform: translateY(-2px);
        }
        .quick-btn.active {
            background: var(--gold);
            color: var(--deep);
            border-color: var(--gold);
            font-weight: 700;
        }

        /* === DIVIDER === */
        .ornament-divider {
            text-align: center;
            margin: 2.5rem 0;
            position: relative;
        }
        .ornament-divider::before, .ornament-divider::after {
            content: '';
            position: absolute;
            top: 50%;
            width: 35%;
            height: 1px;
            background: linear-gradient(to var(--dir, left), transparent, rgba(201,168,76,0.4));
        }
        .ornament-divider::before { right: 0; --dir: right; }
        .ornament-divider::after { left: 0; --dir: left; }
        .ornament-divider span {
            color: var(--gold);
            font-size: 1.4rem;
            position: relative;
            z-index: 1;
            letter-spacing: 0.3em;
        }

        /* Day reading modal / panel */
        .day-reading-bar {
            display: none;
            background: linear-gradient(135deg, rgba(201,168,76,0.12), rgba(17,34,64,0.9));
            border: 1px solid rgba(201,168,76,0.3);
            border-radius: 16px;
            padding: 16px 20px;
            margin-bottom: 2rem;
            animation: fadeIn 0.4s ease;
        }

        .day-reading-bar.visible {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 12px;
        }

        .day-reading-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .day-reading-title {
            font-family: 'Noto Serif Hebrew', serif;
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--gold-light);
        }

        .day-reading-subtitle {
            font-size: 0.78rem;
            color: var(--text-dim);
        }

        .day-reading-btns {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .day-chapter-btn {
            background: var(--navy-mid);
            border: 1px solid rgba(201,168,76,0.25);
            border-radius: 8px;
            color: var(--gold);
            font-family: 'Noto Serif Hebrew', serif;
            font-size: 0.8rem;
            padding: 6px 10px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .day-chapter-btn:hover {
            background: var(--gold);
            color: var(--deep);
            border-color: var(--gold);
        }
        .day-chapter-btn.reading {
            background: var(--gold);
            color: var(--deep);
            font-weight: 700;
        }
        .day-chapter-btn.done {
            background: rgba(34,197,94,0.12);
            border-color: rgba(34,197,94,0.45);
            color: #4ade80;
            position: relative;
        }
        .day-chapter-btn.done::after {
            content: 'âœ“';
            position: absolute;
            top: -5px;
            left: -5px;
            width: 13px;
            height: 13px;
            background: #22c55e;
            color: white;
            border-radius: 50%;
            font-size: 0.5rem;
            line-height: 13px;
            text-align: center;
            display: block;
        }
        .day-chapter-btn.done.reading {
            background: var(--gold);
            color: var(--deep);
            border-color: var(--gold);
        }
        .day-done-progress {
            font-size: 0.62rem;
            color: #4ade80;
            margin-top: 3px;
            position: relative;
            z-index: 1;
            display: none;
        }
        .day-done-progress.has-progress {
            display: block;
        }

        .mark-read-wrap {
            text-align: center;
            margin-top: 2.5rem;
        }
        .btn-mark-read {
            background: var(--navy-mid);
            border: 1.5px solid rgba(201,168,76,0.3);
            border-radius: 50px;
            color: var(--text-dim);
            font-family: 'Noto Serif Hebrew', serif;
            font-size: 1rem;
            padding: 12px 28px;
            cursor: pointer;
            transition: all 0.25s;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }
        .btn-mark-read:hover {
            border-color: var(--gold);
            color: var(--gold);
            background: var(--gold-dim);
        }
        .btn-mark-read.done {
            background: rgba(34,197,94,0.12);
            border-color: rgba(34,197,94,0.5);
            color: #4ade80;
        }
        .btn-mark-read.done:hover {
            background: rgba(220,38,38,0.1);
            border-color: rgba(220,38,38,0.4);
            color: #f87171;
        }

        /* === CHAPTER CARD === */
        .chapter-card {
            background: linear-gradient(160deg, var(--navy-mid) 0%, rgba(10,22,40,0.95) 100%);
            border: 1px solid rgba(201,168,76,0.2);
            border-radius: 24px;
            overflow: hidden;
            box-shadow: 0 30px 80px rgba(0,0,0,0.5), inset 0 1px 0 rgba(201,168,76,0.1);
            transition: opacity 0.4s;
        }

        .card-topbar {
            height: 3px;
            background: linear-gradient(90deg, transparent, var(--gold), var(--gold-light), var(--gold), transparent);
            box-shadow: 0 0 20px rgba(201,168,76,0.5);
        }

        .card-inner {
            padding: 2.5rem 2rem;
        }
        @media (min-width: 600px) { .card-inner { padding: 4rem 5rem; } }

        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
        }
        .empty-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.3;
        }
        .empty-text {
            font-family: 'Noto Serif Hebrew', serif;
            font-size: 1.4rem;
            color: var(--text-dim);
            line-height: 1.7;
        }
        .empty-hint {
            margin-top: 0.8rem;
            font-size: 0.85rem;
            color: var(--gold);
            opacity: 0.7;
        }

        #perekTitle {
            font-family: 'Noto Serif Hebrew', serif;
            font-size: 2.5rem;
            font-weight: 900;
            color: var(--gold);
            text-align: center;
            margin-bottom: 0.5rem;
            text-shadow: 0 0 30px rgba(201,168,76,0.3);
            letter-spacing: 0.02em;
        }
        @media (min-width: 600px) { #perekTitle { font-size: 3.5rem; } }

        .chapter-subtitle {
            text-align: center;
            color: var(--text-dim);
            font-size: 0.8rem;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            margin-bottom: 3rem;
        }

        #perekBody {
            font-family: 'Noto Serif Hebrew', serif;
            font-size: 1.5rem;
            line-height: 2.6;
            color: var(--text);
            text-align: right;
            transition: opacity 0.4s;
        }
        @media (min-width: 600px) { #perekBody { font-size: 1.75rem; } }

        .verse-sep {
            color: rgba(201,168,76,0.35);
            font-size: 1rem;
            padding: 0 6px;
            vertical-align: middle;
        }

        #loader {
            text-align: center;
            padding: 5rem;
            display: none;
        }
        .loader-spinner {
            width: 48px;
            height: 48px;
            border: 3px solid rgba(201,168,76,0.15);
            border-top-color: var(--gold);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 1rem;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loader-text {
            color: var(--text-dim);
            font-family: 'Noto Serif Hebrew', serif;
            font-size: 1.1rem;
        }

        .chapter-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid rgba(201,168,76,0.15);
        }
        .nav-btn {
            background: none;
            border: 1px solid rgba(201,168,76,0.2);
            border-radius: 12px;
            color: var(--gold);
            padding: 10px 18px;
            font-family: 'Noto Serif Hebrew', serif;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.25s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .nav-btn:hover {
            background: var(--gold-dim);
            border-color: var(--gold);
            transform: translateY(-1px);
        }
        .nav-btn:disabled {
            opacity: 0.2;
            cursor: not-allowed;
            transform: none;
        }

        .chapter-counter {
            font-size: 0.8rem;
            color: var(--text-dim);
            font-weight: 500;
        }

        footer {
            position: relative;
            z-index: 1;
            border-top: 1px solid rgba(201,168,76,0.1);
            padding: 2rem;
            text-align: center;
            background: rgba(5,16,31,0.6);
        }
        .footer-text {
            font-size: 0.8rem;
            color: var(--text-dim);
        }
        .footer-text span { color: var(--gold); }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(12px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-in {
            animation: fadeIn 0.5s ease forwards;
        }
    </style>
</head>
<body>

    <header>
        <div class="header-inner">
            <div class="logo">
                <div class="logo-icon">×ª</div>
                <div class="logo-text">
                    ×ª×”×™×œ×™×
                    <div class="logo-subtitle">×œ×›×‘×•×“ ×”×¨×‘ ×™×•×¨× ××™×›××œ ××‘×¨×’'×œ ×–×¦×•×§"×œ</div>
                    <div class="logo-subtitle">×œ×¢×™×œ×•×™ × ×©××ª ×’×‘×¨×™××œ ×‘×Ÿ ××œ×›×” ×–"×œ</div>
                </div>
            </div>
            <div class="header-actions">
                <button class="btn-whatsapp" onclick="shareToWhatsapp()" title="×©×ª×£ ×‘×•×•××˜×¡××¤">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M13.601 2.326A7.854 7.854 0 0 0 7.994 0C3.627 0 .068 3.558.064 7.926c0 1.399.366 2.76 1.06 3.973L0 16l4.104-1.076a7.858 7.858 0 0 0 3.888 1.02h.003c4.365 0 7.923-3.559 7.927-7.928a7.905 7.905 0 0 0-2.32-5.69zM7.994 14.52a6.573 6.573 0 0 1-3.356-.92l-.24-.144-2.494.654.666-2.433-.156-.251a6.56 6.56 0 0 1-1.007-3.505c0-3.626 2.957-6.584 6.591-6.584a6.56 6.56 0 0 1 4.66 1.931 6.557 6.557 0 0 1 1.928 4.66c-.004 3.639-2.961 6.592-6.592 6.592zm3.615-4.934c-.197-.099-1.17-.578-1.353-.646-.182-.065-.315-.099-.445.099-.133.197-.513.646-.627.775-.114.133-.232.148-.43.05-.197-.1-.836-.308-1.592-.985-.59-.525-.985-1.175-1.103-1.372-.114-.198-.011-.304.088-.403.087-.088.197-.232.296-.346.1-.114.133-.198.198-.33.065-.134.034-.248-.015-.347-.05-.099-.445-1.076-.612-1.47-.16-.389-.323-.335-.445-.34-.114-.007-.247-.007-.38-.007a.729.729 0 0 0-.529.247c-.182.198-.691.677-.691 1.654 0 .977.71 1.916.81 2.049.098.133 1.394 2.132 3.383 2.992.47.205.84.326 1.129.418.475.152.904.129 1.246.08.38-.058 1.171-.48 1.338-.943.164-.464.164-.86.114-.943-.049-.084-.182-.133-.38-.232z"/>
                    </svg>
                </button>
                <button class="btn-random" onclick="getRandomPerek()">âœ¨ ×¤×¨×§ ××§×¨××™</button>
            </div>
        </div>
    </header>

    <main>

        <!-- Daily Reading Section -->
        <div class="daily-section">
            <p class="daily-label">âœ¦ ×§×¨×™××” ×™×•××™×ª âœ¦</p>
            <div class="days-grid" id="daysGrid"></div>
        </div>

        <!-- Day Reading Bar (appears when a day is selected) -->
        <div class="day-reading-bar" id="dayReadingBar">
            <div class="day-reading-info">
                <div class="day-reading-title" id="dayReadingTitle"></div>
                <div class="day-reading-subtitle" id="dayReadingSubtitle"></div>
            </div>
            <div class="day-reading-btns" id="dayReadingBtns"></div>
        </div>

        <div class="ornament-divider"><span>âœ¦ âœ¦ âœ¦</span></div>

        <!-- Selector -->
        <div class="selector-section">
            <p class="selector-label">âœ¦ ×‘×—×¨ ××–××•×¨ âœ¦</p>
            <div class="selector-wrapper">
                <select id="perekSelect" onchange="fetchPerek(this.value)"></select>
            </div>
            <div class="quick-grid" id="quickGrid"></div>
        </div>

        <div class="ornament-divider"><span>âœ¦ âœ¦ âœ¦</span></div>

        <!-- Loader -->
        <div id="loader">
            <div class="loader-spinner"></div>
            <p class="loader-text">×˜×•×¢×Ÿ ××–××•×¨...</p>
        </div>

        <!-- Chapter Card -->
        <div class="chapter-card" id="chapterCard">
            <div class="card-topbar"></div>
            <div class="card-inner">
                <div id="emptyState" class="empty-state">
                    <div class="empty-icon">ğŸ“–</div>
                    <div class="empty-text">×‘×—×¨ ×¤×¨×§ ××”×¨×©×™××” ×œ××¢×œ×”<br>×›×“×™ ×œ×”×ª×—×™×œ ×‘×§×¨×™××”</div>
                    <div class="empty-hint">150 ×¤×¨×§×™× Â· ×¡×¤×¨ ×ª×”×™×œ×™×</div>
                </div>
                <div id="chapterContent" style="display:none;">
                    <h2 id="perekTitle"></h2>
                    <p class="chapter-subtitle" id="chapterSubtitle"></p>
                    <div id="perekBody"></div>
                    <div class="mark-read-wrap">
                        <button class="btn-mark-read" id="btnMarkRead" onclick="toggleRead()">
                            <span id="markReadIcon">â˜</span>
                            <span id="markReadText">×¡×™×× ×ª×™ ×©×§×¨××ª×™</span>
                        </button>
                    </div>
                    <div class="chapter-nav">
                        <button class="nav-btn" id="btnPrev" onclick="navigate(-1)">×”×§×•×“× â—€</button>
                        <span class="chapter-counter" id="chapterCounter"></span>
                        <button class="nav-btn" id="btnNext" onclick="navigate(1)">â–¶ ×”×‘×</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <p class="footer-text">Â© ×›×œ ×”×–×›×•×™×•×ª ×©××•×¨×•×ª ×œ<span>××‘×™×¨×Ÿ ×‘×Ÿ ×©×œ×•×</span> Â· ×¡×¤×¨ ×ª×”×™×œ×™×</p>
    </footer>

    <script>
        const perekSelect = document.getElementById('perekSelect');
        const perekTitle = document.getElementById('perekTitle');
        const perekBody = document.getElementById('perekBody');
        const loader = document.getElementById('loader');
        const chapterContent = document.getElementById('chapterContent');
        const emptyState = document.getElementById('emptyState');
        const chapterCounter = document.getElementById('chapterCounter');
        const chapterSubtitle = document.getElementById('chapterSubtitle');

        let currentChapter = 0;
        let selectedDay = null;

        // === READ TRACKING via localStorage ===
        const todayKey = 'tehillim_read_' + new Date().toISOString().slice(0, 10);

        function getReadSet() {
            try { return new Set(JSON.parse(localStorage.getItem(todayKey) || '[]')); }
            catch { return new Set(); }
        }
        function markAsRead(num) {
            const s = getReadSet(); s.add(num);
            localStorage.setItem(todayKey, JSON.stringify([...s]));
        }
        function isRead(num) { return getReadSet().has(num); }

        // Daily reading schedule (1-indexed chapters)
        const dailySchedule = [
            { name: '×¨××©×•×Ÿ',  range: [1, 29],    label: '× â€“ ×›×˜' },
            { name: '×©× ×™',    range: [30, 50],   label: '×œ â€“ × ' },
            { name: '×©×œ×™×©×™', range: [51, 72],   label: '× × â€“ ×¢×‘' },
            { name: '×¨×‘×™×¢×™', range: [73, 89],   label: '×¢×’ â€“ ×¤×˜' },
            { name: '×—××™×©×™', range: [90, 106],  label: '×¦ â€“ ×§×•' },
            { name: '×©×™×©×™',  range: [107, 119], label: '×§×– â€“ ×§×™×˜' },
            { name: '×©×‘×ª',   range: [120, 150], label: '×§×› â€“ ×§× ' },
        ];

        // Get today's day index (0=Sun, 1=Mon ... 6=Sat â†’ map to our schedule)
        // JS: 0=Sunday, 1=Monday, 2=Tuesday, 3=Wednesday, 4=Thursday, 5=Friday, 6=Saturday
        // Our schedule index: 0=Sun(×¨××©×•×Ÿ), 1=Mon(×©× ×™), ..., 6=Sat(×©×‘×ª)
        const todayIndex = new Date().getDay(); // 0â€“6

        function toGematria(num) {
            const letters = {1:'×',2:'×‘',3:'×’',4:'×“',5:'×”',6:'×•',7:'×–',8:'×—',9:'×˜',10:'×™',20:'×›',30:'×œ',40:'×',50:'× ',60:'×¡',70:'×¢',80:'×¤',90:'×¦',100:'×§'};
            if (num <= 10) return letters[num];
            if (num < 100) {
                let tens = Math.floor(num / 10) * 10, units = num % 10;
                let res = letters[tens] + (units ? letters[units] : '');
                return res.replace('×™×”', '×˜×•').replace('×™×•', '×˜×–');
            }
            if (num >= 100) {
                let remainder = num - 100;
                return letters[100] + (remainder ? toGematria(remainder) : '');
            }
        }

        // Build days grid
        const daysGrid = document.getElementById('daysGrid');
        dailySchedule.forEach((day, i) => {
            const card = document.createElement('div');
            card.className = 'day-card' + (i === todayIndex ? ' today' : '');
            card.dataset.index = i;
            card.id = 'dayCard_' + i;

            const count = day.range[1] - day.range[0] + 1;
            const readCount = [...Array(count)].filter((_, j) => isRead(day.range[0] + j)).length;
            const progressText = readCount > 0 ? `âœ“ ${readCount}/${count}` : '';

            card.innerHTML = `
                ${i === todayIndex ? '<div class="today-badge">×”×™×•×</div>' : ''}
                <div class="day-name" style="${i === todayIndex ? 'margin-top:14px' : ''}">${day.name}</div>
                <div class="day-range">${day.label}</div>
                <div class="day-count">${count} ×¤×¨×§×™×</div>
                <div class="day-done-progress ${readCount > 0 ? 'has-progress' : ''}" id="dayProgress_${i}">${progressText}</div>
            `;

            card.onclick = () => selectDay(i);
            daysGrid.appendChild(card);
        });

        function selectDay(index) {
            selectedDay = index;
            const day = dailySchedule[index];

            // Update active state
            document.querySelectorAll('.day-card').forEach((c, i) => {
                c.style.borderColor = i === index ? 'var(--gold)' : '';
                c.style.background = i === index ? 'rgba(201,168,76,0.1)' : '';
            });

            // Show day reading bar
            const bar = document.getElementById('dayReadingBar');
            const title = document.getElementById('dayReadingTitle');
            const subtitle = document.getElementById('dayReadingSubtitle');
            const btns = document.getElementById('dayReadingBtns');

            title.textContent = `×™×•× ${day.name} Â· ${day.label}`;
            subtitle.textContent = `${day.range[1] - day.range[0] + 1} ×¤×¨×§×™× ×œ×§×¨×™××”`;

            btns.innerHTML = '';
            for (let ch = day.range[0]; ch <= day.range[1]; ch++) {
                const btn = document.createElement('button');
                const read = isRead(ch);
                btn.className = 'day-chapter-btn' + (ch === currentChapter ? ' reading' : '') + (read ? ' done' : '');
                btn.dataset.num = ch;
                btn.textContent = toGematria(ch);
                btn.title = `×¤×¨×§ ${toGematria(ch)}${read ? ' (× ×§×¨×)' : ''}`;
                const chNum = ch;
                btn.onclick = () => {
                    fetchPerek(chNum);
                    document.querySelectorAll('.day-chapter-btn').forEach(b => b.classList.remove('reading'));
                    btn.classList.add('reading');
                };
                btns.appendChild(btn);
            }

            // Update subtitle with read count
            const total = day.range[1] - day.range[0] + 1;
            const readCount = [...getReadSet()].filter(n => n >= day.range[0] && n <= day.range[1]).length;
            subtitle.textContent = readCount > 0
                ? `${readCount} ××ª×•×š ${total} ×¤×¨×§×™× × ×§×¨××• âœ“`
                : `${total} ×¤×¨×§×™× ×œ×§×¨×™××”`;

            bar.classList.add('visible');

            // Scroll bar into view
            bar.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // Quick chapters
        const famousChapters = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11];
        const quickGrid = document.getElementById('quickGrid');
        famousChapters.forEach(n => {
            const btn = document.createElement('button');
            btn.className = 'quick-btn';
            btn.dataset.num = n;
            btn.textContent = toGematria(n);
            btn.title = `×¤×¨×§ ${toGematria(n)}`;
            btn.onclick = () => fetchPerek(n);
            quickGrid.appendChild(btn);
        });

        // Populate dropdown
        for (let i = 1; i <= 150; i++) {
            const option = document.createElement('option');
            option.value = i;
            option.textContent = `×¤×¨×§ ${toGematria(i)}`;
            perekSelect.appendChild(option);
        }

        async function fetchPerek(num) {
            num = parseInt(num);
            if (!num) return;

            loader.style.display = 'block';
            chapterContent.style.display = 'none';
            emptyState.style.display = 'none';

            document.querySelectorAll('.quick-btn').forEach(b => {
                b.classList.toggle('active', parseInt(b.dataset.num) === num);
            });
            perekSelect.value = num;
            currentChapter = num;

            // Update day reading bar button if visible
            document.querySelectorAll('.day-chapter-btn').forEach(b => {
                b.classList.toggle('reading', parseInt(b.dataset.num) === num);
            });

            try {
                const response = await fetch(`https://www.sefaria.org/api/texts/Psalms.${num}?context=0&commentary=0`);
                const data = await response.json();

                const cleanText = data.he.map((v, i) => {
                    const verseNum = toGematria(i + 1);
                    return `<span style="color:var(--gold);font-size:0.85em;margin-left:8px;opacity:0.7;">${verseNum}</span>${v}`;
                }).join(' <span class="verse-sep">×ƒ</span> ');

                perekTitle.textContent = `×¤×¨×§ ${toGematria(num)}`;
                chapterSubtitle.textContent = `××–××•×¨ ${num} ××ª×•×š 150 Â· ×¡×¤×¨ ×ª×”×™×œ×™×`;
                perekBody.innerHTML = cleanText;

                chapterCounter.textContent = `${num} / 150`;
                document.getElementById('btnPrev').disabled = num <= 1;
                document.getElementById('btnNext').disabled = num >= 150;

                loader.style.display = 'none';
                chapterContent.style.display = 'block';
                chapterContent.classList.remove('animate-in');
                void chapterContent.offsetWidth;
                chapterContent.classList.add('animate-in');

                // Update mark-read button state (no auto-marking)
                updateMarkReadBtn(num);

                document.getElementById('chapterCard').scrollIntoView({ behavior: 'smooth', block: 'start' });
            } catch (e) {
                loader.style.display = 'none';
                emptyState.style.display = 'block';
                emptyState.querySelector('.empty-text').textContent = '×©×’×™××” ×‘×˜×¢×™× ×ª ×”×¤×¨×§. × ×¡×” ×©× ×™×ª.';
            }
        }

        function updateMarkReadBtn(num) {
            const btn = document.getElementById('btnMarkRead');
            const icon = document.getElementById('markReadIcon');
            const text = document.getElementById('markReadText');
            if (!btn) return;
            const read = isRead(num);
            btn.className = 'btn-mark-read' + (read ? ' done' : '');
            icon.textContent = read ? 'âœ“' : 'â˜';
            text.textContent = read ? '×§×¨××ª×™! (×œ×—×¥ ×œ×‘×™×˜×•×œ)' : '×§×¨××ª×™';
        }

        function updateReadUI(num) {
            // Update day chapter buttons
            document.querySelectorAll('.day-chapter-btn').forEach(b => {
                if (parseInt(b.dataset.num) === num) {
                    b.classList.toggle('done', isRead(num));
                }
            });
            // Update day card progress
            dailySchedule.forEach((day, i) => {
                if (num >= day.range[0] && num <= day.range[1]) {
                    const total = day.range[1] - day.range[0] + 1;
                    const rc = [...getReadSet()].filter(n => n >= day.range[0] && n <= day.range[1]).length;
                    const el = document.getElementById('dayProgress_' + i);
                    if (el) {
                        el.textContent = rc > 0 ? `âœ“ ${rc}/${total}` : '';
                        el.classList.toggle('has-progress', rc > 0);
                    }
                    if (selectedDay === i) {
                        document.getElementById('dayReadingSubtitle').textContent = rc > 0
                            ? `${rc} ××ª×•×š ${total} ×¤×¨×§×™× × ×§×¨××• âœ“`
                            : `${total} ×¤×¨×§×™× ×œ×§×¨×™××”`;
                    }
                }
            });
        }

        function toggleRead() {
            if (!currentChapter) return;
            const s = getReadSet();
            if (s.has(currentChapter)) {
                s.delete(currentChapter);
            } else {
                s.add(currentChapter);
            }
            localStorage.setItem(todayKey, JSON.stringify([...s]));
            updateMarkReadBtn(currentChapter);
            updateReadUI(currentChapter);
        }

        function navigate(dir) {
            const next = currentChapter + dir;
            if (next >= 1 && next <= 150) fetchPerek(next);
        }

        function getRandomPerek() {
            fetchPerek(Math.floor(Math.random() * 150) + 1);
        }

        function shareToWhatsapp() {
            const currentText = currentChapter > 0
                ? `×¤×¨×§ ${toGematria(currentChapter)}`
                : '×¡×¤×¨ ×ª×”×™×œ×™×';
            const text = `××–××™×Ÿ ××•×ª×š ×œ×§×¨×•× ×ª×”×™×œ×™× ××™×ª×™: ${currentText}\n${window.location.href}`;
            window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, '_blank');
        }

        // Auto-highlight today's day on load
        window.addEventListener('load', () => {
            // Slight delay for visual polish
            setTimeout(() => {
                const todayCard = document.querySelector(`.day-card.today`);
                if (todayCard) {
                    todayCard.style.animation = 'pulse 0.6s ease';
                }
            }, 300);
        });
    </script>
</body>
</html>
